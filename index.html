<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI 服裝搭配師</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#db2777" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="AI 穿搭師" />
    <meta name="description" content="您的個人 AI 服裝搭配師，輕鬆管理您的衣櫥並獲得每日穿搭建議。">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        #loading-spinner { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 8px solid #f3f3f3; border-top: 8px solid #db2777; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100">
    <noscript>您需要啟用 JavaScript 才能執行此應用程式。</noscript>
    <div id="root"><div id="loading-spinner"></div></div>

    <script type="text/babel">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadString, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        const { useState, useEffect, useRef } = React;

        const createSvgIcon = (path) => (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke={props.color || 'currentColor'} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{path}</svg>
        );
        const UserIcon = createSvgIcon(<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>);
        const PlusIcon = createSvgIcon(<><path d="M5 12h14" /><path d="M12 5v14" /></>);
        const CameraIcon = createSvgIcon(<><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></>);
        const Trash2Icon = createSvgIcon(<><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>);
        const Wand2Icon = createSvgIcon(<><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L11.8 9.2a1.21 1.21 0 0 0 0 1.72l5.8 5.8a1.21 1.21 0 0 0 1.72 0l6.84-6.84a1.21 1.21 0 0 0 0-1.72Z" /><path d="m14 7 3 3" /><path d="M5 6v4" /><path d="M19 14v4" /><path d="M10 2v2" /><path d="M7 8H3" /><path d="M21 16h-4" /><path d="M11 3H9" /></>);
        const RefreshCwIcon = createSvgIcon(<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M3 21v-5h5" /></>);
        const LightbulbIcon = createSvgIcon(<><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" /><path d="M9 18h6" /><path d="M10 22h4" /></>);
        const XIcon = createSvgIcon(<><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>);
        
        // --- Firebase Configuration ---
        // IMPORTANT: Replace these placeholders with your actual Firebase config values.
        const firebaseConfig = {
  apiKey: "AIzaSyB9a_0V_y8ZayqGgd8vPmID3FcgS8rfteY",
  authDomain: "fashion-stylist-app.firebaseapp.com",
  projectId: "fashion-stylist-app",
  storageBucket: "fashion-stylist-app.firebasestorage.app",
  messagingSenderId: "185771802038",
  appId: "1:185771802038:web:4a4aebe3d540d7ab951517",
  measurementId: "G-V4Z3M46WX4"
        };

        let app, auth, db, storage;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
        } catch (e) {
            console.error("Firebase initialization failed. Please check your config.", e);
            document.getElementById('root').innerHTML = `<div class="p-4 text-red-700 bg-red-100 border border-red-400 rounded-lg">Firebase 設定錯誤，請確認您的金鑰是否正確。</div>`;
        }
        
        function App() {
            const [user, setUser] = useState(null);
            const [profiles, setProfiles] = useState([]);
            const [activeProfile, setActiveProfile] = useState(null);
            const [clothingItems, setClothingItems] = useState([]);
            const [tops, setTops] = useState([]);
            const [bottoms, setBottoms] = useState([]);
            const [suggestions, setSuggestions] = useState([]);
            const [manualSelection, setManualSelection] = useState({ top: null, bottom: null });
            const [manualSuggestion, setManualSuggestion] = useState('');
            const [view, setView] = useState('suggestions');
            const [loading, setLoading] = useState({ suggestions: false, manual: false, upload: false, gallery: false });
            const [error, setError] = useState('');
            const fileInputRef = useRef(null);
            const [isProfileModalOpen, setProfileModalOpen] = useState(false);
            const [newProfileName, setNewProfileName] = useState('');
            const [isDeleteModalOpen, setDeleteModalOpen] = useState(false);
            const [itemToDelete, setItemToDelete] = useState(null);

            useEffect(() => {
                if (!auth) return;
                const unsub = onAuthStateChanged(auth, u => u ? setUser(u) : signInAnonymously(auth).catch(e => setError("驗證失敗")));
                return () => unsub();
            }, []);

            useEffect(() => {
                if (!user || !db) return;
                const q = query(collection(db, `users/${user.uid}/profiles`));
                const unsub = onSnapshot(q, snap => {
                    const profilesData = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setProfiles(profilesData);
                    if (!activeProfile && profilesData.length > 0) setActiveProfile(profilesData[0]);
                    else if (profilesData.length === 0) setActiveProfile(null);
                }, e => setError("讀取使用者資料失敗"));
                return () => unsub();
            }, [user, activeProfile]);

            useEffect(() => {
                if (!activeProfile || !user || !db) {
                    setClothingItems([]); setTops([]); setBottoms([]); setSuggestions([]);
                    return;
                }
                setLoading(p => ({ ...p, gallery: true, suggestions: true }));
                const q = query(collection(db, `clothingItems`), where("userId", "==", user.uid), where("profileId", "==", activeProfile.id));
                const unsub = onSnapshot(q, snap => {
                    const items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    const currentTops = items.filter(i => i.category === 'top');
                    const currentBottoms = items.filter(i => i.category === 'bottom');
                    setClothingItems(items); setTops(currentTops); setBottoms(currentBottoms);
                    setLoading(p => ({ ...p, gallery: false }));
                    if (view === 'suggestions' && items.length > 0) generateSuggestions(currentTops, currentBottoms);
                    else setLoading(p => ({ ...p, suggestions: false }));
                }, e => { setError("讀取衣物資料失敗"); setLoading(p => ({ ...p, gallery: false, suggestions: false })); });
                return () => unsub();
            }, [activeProfile, user]);

            const callGeminiAPI = async (prompt, imageData = null) => {
                try {
                    const response = await fetch('/api/gemini', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt, imageData })
                    });
                    if (!response.ok) {
                        const errBody = await response.json();
                        throw new Error(errBody.error || 'API 請求失敗');
                    }
                    const result = await response.json();
                    return result.text;
                } catch (error) {
                    console.error("Error calling our API:", error);
                    setError(`AI 服務暫時無法使用: ${error.message}`);
                    return null;
                }
            };
            
            const handleAddProfile = async () => {
                if (newProfileName.trim() && user) {
                    try {
                        await addDoc(collection(db, `users/${user.uid}/profiles`), { name: newProfileName.trim() });
                    } catch (error) { setError("新增使用者失敗。"); }
                }
                setNewProfileName(''); setProfileModalOpen(false);
            };

            const handleImageUpload = async (event) => {
                const file = event.target.files[0];
                if (!file || !activeProfile) return;
                setLoading(p => ({ ...p, upload: true })); setError('');
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = async () => {
                    const base64 = reader.result.replace(/^.+,/, '');
                    const category = await callGeminiAPI("這是一件上半身衣物（top）還是一件下半身衣物（bottom）？請只回答 'top' 或 'bottom'。", base64);
                    if (category === 'top' || category === 'bottom') {
                        const storageRef = ref(storage, `clothing/${user.uid}/${activeProfile.id}/${Date.now()}_${file.name}`);
                        try {
                            const snap = await uploadString(storageRef, reader.result, 'data_url');
                            const url = await getDownloadURL(snap.ref);
                            await addDoc(collection(db, `clothingItems`), { userId: user.uid, profileId: activeProfile.id, imageUrl: url, storagePath: snap.ref.fullPath, category, createdAt: new Date() });
                            setView('gallery');
                        } catch (error) { setError("上傳圖片或儲存資料失敗。"); }
                    } else { setError("AI 無法識別這件衣物。"); }
                    setLoading(p => ({ ...p, upload: false }));
                };
                reader.onerror = () => { setError("讀取檔案失敗。"); setLoading(p => ({ ...p, upload: false })); };
            };

            const generateSuggestions = async (currentTops, currentBottoms) => {
                if (currentTops.length === 0 || currentBottoms.length === 0) {
                    setSuggestions([]); setLoading(p => ({ ...p, suggestions: false })); return;
                }
                setLoading(p => ({ ...p, suggestions: true }));
                const newSuggestions = []; const usedPairs = new Set();
                const attempts = Math.min(3, currentTops.length * currentBottoms.length);
                while (newSuggestions.length < attempts) {
                    let top, bottom, pairKey, maxTries = 10;
                    do {
                        top = currentTops[Math.floor(Math.random() * currentTops.length)];
                        bottom = currentBottoms[Math.floor(Math.random() * currentBottoms.length)];
                        pairKey = `${top.id}-${bottom.id}`;
                    } while (usedPairs.has(pairKey) && --maxTries > 0);
                    if (maxTries === 0) break;
                    usedPairs.add(pairKey);
                    try {
                        const toBase64 = blob => new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result.split(',')[1]);
                            reader.onerror = reject;
                            reader.readAsDataURL(blob);
                        });
                        const [topRes, bottomRes] = await Promise.all([fetch(top.imageUrl), fetch(bottom.imageUrl)]);
                        const [topBlob, bottomBlob] = await Promise.all([topRes.blob(), bottomRes.blob()]);
                        const [topBase64, bottomBase64] = await Promise.all([toBase64(topBlob), toBase64(bottomBlob)]);
                        const comment = await callGeminiAPI("這是一套服裝搭配，請用繁體中文給出一句簡短（最多20字）且吸引人的穿搭建議。", [topBase64, bottomBase64]);
                        newSuggestions.push({ top, bottom, comment: comment || "試試這個組合！" });
                    } catch (error) { newSuggestions.push({ top, bottom, comment: "清新的組合，適合今天！" }); }
                }
                setSuggestions(newSuggestions); setLoading(p => ({ ...p, suggestions: false }));
            };

            const getManualSuggestion = async () => {
                if (!manualSelection.top || !manualSelection.bottom) return;
                setLoading(p => ({ ...p, manual: true })); setManualSuggestion('');
                try {
                    const toBase64 = blob => new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result.split(',')[1]);
                        reader.onerror = reject;
                        reader.readAsDataURL(blob);
                    });
                    const [topRes, bottomRes] = await Promise.all([fetch(manualSelection.top.imageUrl), fetch(manualSelection.bottom.imageUrl)]);
                    const [topBlob, bottomBlob] = await Promise.all([topRes.blob(), bottomRes.blob()]);
                    const [topBase64, bottomBase64] = await Promise.all([toBase64(topBlob), toBase64(bottomBlob)]);
                    const comment = await callGeminiAPI("這是一套使用者自己搭配的服裝，請用繁體中文以專業且鼓勵的語氣給出建議（約30-40字）。", [topBase64, bottomBase64]);
                    setManualSuggestion(comment || "很棒的選擇！");
                } catch (error) { setManualSuggestion("您的搭配很有創意！"); }
                setLoading(p => ({ ...p, manual: false }));
            };

            const handleDeleteConfirmation = (item) => { setItemToDelete(item); setDeleteModalOpen(true); };
            
            const confirmDeleteItem = async () => {
                if (!itemToDelete) return;
                try {
                    await deleteDoc(doc(db, "clothingItems", itemToDelete.id));
                    await deleteObject(ref(storage, itemToDelete.storagePath));
                } catch (error) { setError("刪除失敗。"); }
                setItemToDelete(null); setDeleteModalOpen(false);
            };
            
            return (
                <div className="max-w-md mx-auto bg-white shadow-lg min-h-screen relative">
                    {isProfileModalOpen && (
                        <div className="absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-lg p-6 w-full max-w-sm">
                                <h3 className="text-lg font-semibold mb-4">新增使用者</h3>
                                <input type="text" value={newProfileName} onChange={(e) => setNewProfileName(e.target.value)} placeholder="例如：媽媽、女兒" className="w-full border rounded-md px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-pink-500" />
                                <div className="flex justify-end space-x-2">
                                    <button onClick={() => setProfileModalOpen(false)} className="px-4 py-2 bg-gray-200 rounded-md">取消</button>
                                    <button onClick={handleAddProfile} className="px-4 py-2 bg-pink-500 text-white rounded-md">確定</button>
                                </div>
                            </div>
                        </div>
                    )}
                    {isDeleteModalOpen && (
                        <div className="absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-lg p-6 w-full max-w-sm text-center">
                                <h3 className="text-lg font-semibold mb-2">確定刪除？</h3>
                                <p className="text-gray-600 mb-6">您確定要刪除這件衣物嗎？此操作無法復原。</p>
                                <div className="flex justify-center space-x-4">
                                    <button onClick={() => setDeleteModalOpen(false)} className="px-6 py-2 bg-gray-200 rounded-md">取消</button>
                                    <button onClick={confirmDeleteItem} className="px-6 py-2 bg-red-500 text-white rounded-md">刪除</button>
                                </div>
                            </div>
                        </div>
                    )}
                    <header className="bg-white p-4 border-b sticky top-0 z-10 flex items-center justify-between">
                        <div className="flex items-center">
                            <UserIcon className="text-pink-500" />
                            <select value={activeProfile?.id || ''} onChange={(e) => setActiveProfile(profiles.find(p => p.id === e.target.value))} className="ml-2 font-semibold text-lg border-none bg-transparent focus:ring-0" disabled={profiles.length === 0}>
                                {profiles.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                            </select>
                        </div>
                        <button onClick={() => setProfileModalOpen(true)} className="p-2 rounded-full hover:bg-gray-100"><PlusIcon /></button>
                    </header>
                    <main className="p-4 pb-20">
                        {error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4" role="alert">{error} <button onClick={() => setError('')} className="absolute top-0 bottom-0 right-0 px-4 py-3"><XIcon size={20}/></button></div>}
                        {!activeProfile && profiles.length === 0 && <div className="text-center p-8 bg-gray-50 rounded-lg"><h3 className="text-xl font-semibold text-gray-700">歡迎使用 AI 穿搭師！</h3><p className="text-gray-500 mt-2">請點擊右上角的 '+' 來新增第一位使用者。</p></div>}
                        {activeProfile && (
                            <>
                                {view === 'suggestions' && (
                                    <section>
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-2xl font-bold text-gray-800">今日推薦</h2>
                                            <button onClick={() => generateSuggestions(tops, bottoms)} disabled={loading.suggestions || tops.length === 0 || bottoms.length === 0} className="p-2 rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                                <RefreshCwIcon className={loading.suggestions ? 'animate-spin' : ''}/>
                                            </button>
                                        </div>
                                        {loading.suggestions ? <div className="flex flex-col items-center justify-center p-8 text-gray-500"><RefreshCwIcon className="animate-spin h-8 w-8 mb-4" /><p className="text-lg">AI 正在搭配中...</p></div> : (
                                            suggestions.length > 0 ? (
                                                <div className="space-y-6">
                                                    {suggestions.map((s, i) => (
                                                        <div key={i} className="bg-white border rounded-xl overflow-hidden shadow-sm">
                                                            <div className="grid grid-cols-2">
                                                                <img src={s.top.imageUrl} alt="Top" className="w-full h-48 object-cover"/>
                                                                <img src={s.bottom.imageUrl} alt="Bottom" className="w-full h-48 object-cover"/>
                                                            </div>
                                                            <div className="p-4 bg-gray-50">
                                                                <p className="text-gray-700 italic">"{s.comment}"</p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : <div className="text-center p-8 bg-gray-50 rounded-lg"><h3 className="text-xl font-semibold text-gray-700">衣櫥空空的...</h3><p className="text-gray-500 mt-2">請先去「我的衣櫥」新增一些衣物吧！</p></div>
                                        )}
                                    </section>
                                )}
                                {view === 'manual' && (
                                    <section>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-4">自己動手搭</h2>
                                        <div>
                                            <h3 className="font-semibold text-lg mb-2">選擇上身</h3>
                                            <div className="flex overflow-x-auto space-x-3 pb-3 -mx-4 px-4">
                                                {tops.map(item => <img key={item.id} src={item.imageUrl} alt="Top" onClick={() => setManualSelection(prev => ({...prev, top: item}))} className={`w-28 h-36 object-cover rounded-lg flex-shrink-0 cursor-pointer border-4 ${manualSelection.top?.id === item.id ? 'border-pink-500' : 'border-transparent'}`}/>)}
                                            </div>
                                        </div>
                                        <div className="mt-6">
                                            <h3 className="font-semibold text-lg mb-2">選擇下身</h3>
                                            <div className="flex overflow-x-auto space-x-3 pb-3 -mx-4 px-4">
                                                {bottoms.map(item => <img key={item.id} src={item.imageUrl} alt="Bottom" onClick={() => setManualSelection(prev => ({...prev, bottom: item}))} className={`w-28 h-36 object-cover rounded-lg flex-shrink-0 cursor-pointer border-4 ${manualSelection.bottom?.id === item.id ? 'border-pink-500' : 'border-transparent'}`}/>)}
                                            </div>
                                        </div>
                                        {manualSelection.top && manualSelection.bottom && (
                                            <div className="mt-6 text-center">
                                                <button onClick={getManualSuggestion} disabled={loading.manual} className="bg-pink-500 text-white font-bold py-3 px-6 rounded-full w-full flex items-center justify-center disabled:bg-pink-300">
                                                    {loading.manual ? <RefreshCwIcon className="animate-spin mr-2"/> : <LightbulbIcon className="mr-2"/>}
                                                    {loading.manual ? 'AI 思考中...' : '獲取 AI 建議'}
                                                </button>
                                                {manualSuggestion && <div className="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg text-purple-800"><p>{manualSuggestion}</p></div>}
                                            </div>
                                        )}
                                    </section>
                                )}
                                {view === 'add' && (
                                    <section className="flex flex-col items-center justify-center p-4">
                                        <h2 className="text-2xl font-bold text-gray-800 mb-4">新增衣物</h2>
                                        <div className="w-full max-w-xs aspect-square bg-gray-900 rounded-lg flex flex-col items-center justify-center p-4 shadow-lg">
                                            <div className="w-full h-full border-4 border-dashed border-gray-500 rounded-md flex flex-col items-center justify-center text-center text-white">
                                                <CameraIcon className="h-16 w-16 text-gray-400 mb-4"/>
                                                <p className="text-gray-300 mb-6">將衣物置於方框中拍攝</p>
                                            </div>
                                        </div>
                                        <p className="text-gray-600 my-6 text-center">上傳照片，AI 會自動幫您分類！</p>
                                        <button onClick={() => fileInputRef.current.click()} disabled={loading.upload} className="bg-pink-500 text-white font-bold py-3 px-8 rounded-full w-full max-w-xs disabled:bg-pink-300">
                                            {loading.upload ? 'AI 辨識中...' : '開啟相機或選擇照片'}
                                        </button>
                                        <input type="file" accept="image/*" capture="environment" ref={fileInputRef} onChange={handleImageUpload} className="hidden" />
                                        {loading.upload && <div className="mt-4"><div className="flex flex-col items-center justify-center p-8 text-gray-500"><RefreshCwIcon className="animate-spin h-8 w-8 mb-4" /><p className="text-lg">請稍候...</p></div></div>}
                                    </section>
                                )}
                                {view === 'gallery' && (
                                    <section>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-4">我的衣櫥</h2>
                                        {clothingItems.length > 0 ? (
                                            <div className="grid grid-cols-3 gap-2">
                                                {clothingItems.map(item => (
                                                    <div key={item.id} className="relative group">
                                                        <img src={item.imageUrl} alt="Clothing item" className="w-full h-32 object-cover rounded-md"/>
                                                        <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center">
                                                            <button onClick={() => handleDeleteConfirmation(item)} className="w-10 h-10 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transform scale-50 group-hover:scale-100 transition-all duration-300">
                                                                <Trash2Icon size={20}/>
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : <div className="text-center p-8 bg-gray-50 rounded-lg"><h3 className="text-xl font-semibold text-gray-700">衣櫥是空的</h3><p className="text-gray-500 mt-2">點擊下方的「新增衣物」按鈕，開始建立您的數位衣櫥吧！</p></div>}
                                    </section>
                                )}
                            </>
                        )}
                    </main>
                    <footer className="bg-white border-t fixed bottom-0 left-0 right-0 max-w-md mx-auto z-10 p-2">
                        <nav className="flex justify-around">
                            <button onClick={() => setView('suggestions')} className={`flex flex-col items-center w-full p-2 rounded-lg ${view === 'suggestions' ? 'text-pink-500 bg-pink-50' : 'text-gray-500'}`}><Wand2Icon /><span className="text-xs font-medium">AI 推薦</span></button>
                            <button onClick={() => setView('manual')} className={`flex flex-col items-center w-full p-2 rounded-lg ${view === 'manual' ? 'text-pink-500 bg-pink-50' : 'text-gray-500'}`}><LightbulbIcon /><span className="text-xs font-medium">手動搭配</span></button>
                            <button onClick={() => setView('add')} className={`flex flex-col items-center w-full p-2 rounded-lg ${view === 'add' ? 'text-pink-500 bg-pink-50' : 'text-gray-500'}`}><CameraIcon /><span className="text-xs font-medium">新增衣物</span></button>
                            <button onClick={() => setView('gallery')} className={`flex flex-col items-center w-full p-2 rounded-lg ${view === 'gallery' ? 'text-pink-500 bg-pink-50' : 'text-gray-500'}`}><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-6 w-6"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg><span className="text-xs font-medium">我的衣櫥</span></button>
                        </nav>
                    </footer>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service worker registered.', reg))
                    .catch(err => console.error('Service worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
